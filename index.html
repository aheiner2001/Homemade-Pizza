<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Doe Calculator — Pizza Dough</title>
<!-- Recipe-style fonts -->
<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Patrick+Hand&display=swap" rel="stylesheet">
<!-- Recipe stylesheet -->
<link rel="stylesheet" href="styles/recipe.css">
</head>
<body class="recipe">
  <div class="container" role="main">
    <header>
      <div>
        <h1>Doe Calculator — Pizza Dough</h1>
        <!-- <p class="lead">Enter diameter and choose thickness. Shows dough ball grams and ingredient breakdown (grams and volume approximations).</p> -->
      </div>
      <div style="margin-left:auto;text-align:right">
        <div class="small">Based on baker's percentages and factor: <span id="dbg-factor" class="muted">2.387 g/in² (Regular)</span></div>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <label for="diameter">Pizza Size (inches)<span id="diameterDisplay" style="margin-top:6px; font-weight:700; font-size:16px;">12</span></label>
        <input id="diameter" type="range" min="10" max="16" step="1" value="12" />
      
       <!-- //Diameter number in javascript -->
        <div class="input-group">



            <!-- TODO CONNECT to Java -->

      <label for="pizzaQuantity">Number of Pizzas: <span id="quanity_display"style="margin-top:6px; font-weight:700; font-size:16px; class="range-value">2</span></label>
      <input type="range" id="pizzaQuantity" min="1" max="10" value="2" step="1">
    </div>






        <label for="thickness" style="margin-top:10px;">Thickness / Dough factor</label>
        <div class="row">
          <select id="thickness" aria-label="Select thickness">
         
            <option value="2.387" selected>Regular</option>

    
          </select>
          <input id="customFactor" type="number" step="0.001" min="0.1" value="2.387" style="width:120px; display:none;" />
        </div>

        <div class="controls">
          <button id="calcBtn">Calculate</button>
          <button id="resetBtn" class="ghost">Reset</button>
          <label style="margin-left:auto;" class="row small">
            <input id="showVolumes" type="checkbox" checked style="margin-right:8px;" /> Show volume equivalents
          </label>
        </div>

        <div style="margin-top:12px;">
          <!-- <div class="muted">Dough ball (grams):</div> -->
          <div style="font-size:22px; font-weight:700; margin-top:6px;" hidden id="doughWeight">— g</div>
          <!-- <div class="small muted">Formula: area (π · r²) × factor (g per in²)</div> -->
        </div>
      </div>

      <div class="card" id="ingredientsCard">
        <div style="display:flex; align-items:center; justify-content:space-between;">
          <div>
            <div class="muted">Ingredient breakdown</div>
            <div style="font-size:15px; font-weight:700; margin-top:6px;">Ingredients (grams and volumes)</div>
          </div>
          <div>
            <button id="copyBtn" class="copy-btn">Copy</button> 
            <button id="printBtn" class="ghost" style="margin-left:8px;">PDF</button>
          </div>
        </div>

        <table id="ingredientsTable" aria-live="polite">
          <thead>
            <tr>
              <th>Ingredient</th>
              <th>Grams</th>
              <th id="volHeader">Volume</th>
              <th class="right">Notes</th>
            </tr>
          </thead>
          <tbody>
            <!-- rows generated by JS -->
          </tbody>
        </table>
      </div>
    </div>

    <footer>
      <!-- <div>Built from your baker's percentages. Conversions use common kitchen densities (approximations): flour 120 g/cup, sugar 200 g/cup, water 236.588 g/cup, olive oil 216 g/cup, salt ~288 g/cup (or 6 g/tsp), yeast 3 g/tsp.</div> -->
    </footer>
  </div>

<script>
(() => {

//Diameter number
 const diameterSlider = document.getElementById('diameter');
  const diameterDisplay = document.getElementById('diameterDisplay');

  diameterDisplay.textContent = diameterSlider.value;

  diameterSlider.addEventListener('input', () => {
    diameterDisplay.textContent = diameterSlider.value;
  });

  // Quantity slider
  const quantitySlider = document.getElementById('pizzaQuantity');
  const quantityDisplay = document.getElementById('quanity_display');

  quantityDisplay.textContent = quantitySlider.value;

  quantitySlider.addEventListener('input', () => {
    quantityDisplay.textContent = quantitySlider.value;
  });





  // Initialize display
 

  // Update display when slider moves

  // Baker's percentages (decimals)
  const BAKERS_PCT = {
    "flour": 0.592,   // 59.2%
    "water": 0.367,   // 36.7%
    "yeast": 0.0022,  // 0.22%
    "salt": 0.0148,   // 1.48%
    "sugar": 0.0111,  // 1.11%
    "olive_oil": 0.0185, // 1.85%
  };

  // Default factor used in Python: DOUGH_FACTOR = 2.387
  const DEFAULT_FACTOR = 2.387;

  // Conversion references (approximate, common US kitchen conversions)
  // grams per cup for each ingredient (approx)
  const GRAMS_PER_CUP = {
    "flour": 120,      // bread/flour; 1 cup ≈ 120 g
    "water": 236.588,  // 1 cup = 236.588 g
    "sugar": 200,      // granulated sugar ≈ 200 g / cup
    "olive_oil": 216,  // oil ≈ 216 g / cup (density ~0.92-0.93; using 216g)
    "salt": 288,       // table salt ≈ 288 g / cup (but we prefer tsp for salt)
    "yeast": 192       // instant yeast ≈ 192 g / cup (rarely used), we'll use tsp
  };

  // grams per teaspoon approximations (more practical for small measures)
  const GRAMS_PER_TSP = {
    "flour": 2.5,
    "water": 4.92892,
    "sugar": 4.2,
    "olive_oil": 4.5,
    "salt": 6,     // table salt ≈ 6 g per tsp
    "yeast": 3     // instant yeast ≈ 3 g per tsp
  };

  // Helper: calculate dough ball grams from diameter and factor
  function doughBallWeight(diameterInches, factor = DEFAULT_FACTOR) {
    const r = diameterInches / 2.0;
    const area = Math.PI * (r * r);
    return area * factor;
  }

  // Helper: ingredient weights in grams (rounded to 0.1g)
  function ingredientWeights(doughWeightG) {
    const result = {};
    for (const [name, pct] of Object.entries(BAKERS_PCT)) {
      result[name] = Math.round((doughWeightG * pct) * 10) / 10;
    }
    return result;
  }

  // Convert grams to cups/tbsp/tsp (returns object). Uses sensible rounding.
  function gramsToVolumes(grams, ingredientKey) {
    const gPerCup = GRAMS_PER_CUP[ingredientKey];
    const gPerTsp = GRAMS_PER_TSP[ingredientKey];

    // If we don't have a reliable cup conversion (e.g. very small amounts),
    // still compute approximate cups.
    const cups = gPerCup ? grams / gPerCup : null;

    // tablespoons: 1 tbsp = 3 tsp
    const tsp = gPerTsp ? grams / gPerTsp : null;
    const tbsp = tsp !== null ? tsp / 3 : null;

    // Helper format: prefer larger units when > ~0.1
    return {
      cups: cups,
      tbsp: tbsp,
      tsp: tsp
    };
  }

  // Format volume nicely (prioritize tbsp when appropriate)
  function formatVolume(volObj) {
    if (!volObj) return "—";
    const {cups, tbsp, tsp} = volObj;

    // If cups >= 0.125 (~2 tbsp), show cups with 2 decimal places
    if (cups !== null && cups >= 0.125) {
      return `${roundTo(cups, 2)} cup${plural(cups)}`;
    }

    // If tbsp >= 0.5 show tbsp to 1 decimal
    if (tbsp !== null && tbsp >= 0.5) {
      return `${roundTo(tbsp, 1)} tbsp${plural(tbsp)}`;
    }

    // Otherwise use tsp
    if (tsp !== null && tsp >= 0.5) {
      return `${roundTo(tsp, 1)} tsp${plural(tsp)}`;
    }

    // For very small amounts show in grams
    return `${Math.round(volObj.grams || 0)} g`;
  }

  function plural(x){ return Math.abs(x) >= 2 ? 's' : ''; }
  function roundTo(n, d){ const p = Math.pow(10,d||0); return Math.round(n*p)/p; }

  // DOM elements
  const diameterInput = document.getElementById('diameter');
  const thicknessSelect = document.getElementById('thickness');
  const customFactorInput = document.getElementById('customFactor');
  const calcBtn = document.getElementById('calcBtn');
  const resetBtn = document.getElementById('resetBtn');
  const doughWeightEl = document.getElementById('doughWeight');
  const ingredientsTableBody = document.querySelector('#ingredientsTable tbody');
  const showVolumesChk = document.getElementById('showVolumes');
  const dbgFactor = document.getElementById('dbg-factor');
  const copyBtn = document.getElementById('copyBtn');
  const printBtn = document.getElementById('printBtn');
  const volHeader = document.getElementById('volHeader');

  // Show/hide custom factor field
  thicknessSelect.addEventListener('change', () => {
    if (thicknessSelect.value === 'custom') {
      customFactorInput.style.display = 'inline-block';
      dbgFactor.textContent = `${customFactorInput.value} g/in² (Custom)`;
    } else {
      customFactorInput.style.display = 'none';
      dbgFactor.textContent = `${thicknessSelect.value} g/in² (${thicknessSelect.options[thicknessSelect.selectedIndex].text.split(' — ')[0]})`;
    }
  });

  customFactorInput.addEventListener('input', () => {
    dbgFactor.textContent = `${customFactorInput.value} g/in² (Custom)`;
  });

  // Build table rows from ingredient data
  function renderIngredients(ingredients, showVolumes = true) {
    ingredientsTableBody.innerHTML = '';
    // Dough ball row
    // Ingredients map has keys in BAKERS_PCT order
    for (const key of Object.keys(BAKERS_PCT)) {
      const grams = ingredients[key];
      const vol = gramsToVolumes(grams, key);
      const volText = showVolumes ? formatVolume(vol) : '—';
      const namePretty = prettifyName(key);
      const notes = defaultNotes(key, grams);

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${namePretty}</td>
        <td>${grams.toFixed(1)} g</td>
        <td>${volText}</td>
        <td class="right small muted">${notes}</td>
      `;
      ingredientsTableBody.appendChild(tr);
    }
  }

  function prettifyName(k){
    return k.split('_').map(s => s[0].toUpperCase() + s.slice(1)).join(' ');
  }

  function defaultNotes(key, grams){
    if (key === 'salt') return `${Math.round(grams / GRAMS_PER_TSP['salt'])} tsp (approx)`;
    if (key === 'yeast') return `${Math.round(grams / GRAMS_PER_TSP['yeast'])} tsp (approx)`;
    if (key === 'olive_oil') return `${roundTo(grams / GRAMS_PER_TSP['olive_oil'],1)} tsp`;
    return '';
  }

  // Main calculate routine
  function calculate() {
    const diam = parseFloat(diameterInput.value);
    if (isNaN(diam) || diam <= 0) {
      alert('Enter a valid diameter in inches (e.g. 12).');
      return;
    }

    let factor;
    if (thicknessSelect.value === 'custom') {
      factor = parseFloat(customFactorInput.value) || DEFAULT_FACTOR;
    } else {
      factor = parseFloat(thicknessSelect.value) || DEFAULT_FACTOR;
    }

    // compute
    const doughWeight = doughBallWeight(diam, factor);
    const doughRounded = Math.round(doughWeight * 10) / 10;
    doughWeightEl.textContent = `${doughRounded.toFixed(1)} g`;

    const ing = ingredientWeights(doughRounded);
    // render
    renderIngredients(ing, showVolumesChk.checked);

    // update factor debug text
    dbgFactor.textContent = `${factor} g/in² (${thicknessSelect.selectedOptions[0].text})`;
  }

  // Reset to defaults
  function reset() {
    diameterInput.value = 12;
    thicknessSelect.value = '2.387';
    customFactorInput.value = DEFAULT_FACTOR;
    customFactorInput.style.display = 'none';
    showVolumesChk.checked = true;
    doughWeightEl.textContent = '— g';
    ingredientsTableBody.innerHTML = '';
    dbgFactor.textContent = `${DEFAULT_FACTOR} g/in² (Regular)`;
  }

  // Build a text summary for copying
  function buildSummaryText() {
    const diam = parseFloat(diameterInput.value);
    let factor = thicknessSelect.value === 'custom' ? customFactorInput.value : thicknessSelect.value;
    factor = parseFloat(factor) || DEFAULT_FACTOR;
    const dough = doughBallWeight(diam, factor);
    const doughRounded = Math.round(dough*10)/10;
    const ing = ingredientWeights(doughRounded);

    let txt = `Pizza diameter: ${diam}"\nDough factor: ${factor} g/in²\nDough ball: ${doughRounded.toFixed(1)} g\n\nIngredients:\n`;
    for (const [k,v] of Object.entries(ing)) {
      const vol = gramsToVolumes(v, k);
      const volText = showVolumesChk.checked ? formatVolume(vol) : '—';
      txt += ` - ${prettifyName(k)}: ${v.toFixed(1)} g (${volText})\n`;
    }
    txt += `\n(Conversions are approximations.)\nGenerated by Doe Calculator.`;
    return txt;
  }

  // Event listeners
  calcBtn.addEventListener('click', calculate);
  resetBtn.addEventListener('click', reset);
  showVolumesChk.addEventListener('change', () => {
    // toggle volume column header
    volHeader.textContent = showVolumesChk.checked ? 'Volume' : 'Volume (hidden)';
    // re-run calc if results present
    if (doughWeightEl.textContent !== '— g') calculate();
  });

  copyBtn.addEventListener('click', async () => {
    const text = buildSummaryText();
    try {
      await navigator.clipboard.writeText(text);
      copyBtn.textContent = 'Copied!';
      setTimeout(()=> copyBtn.textContent = 'Copy', 1200);
    } catch (e) {
      alert('Could not copy automatically — your browser may block clipboard access. You can copy manually:\n\n' + text);
    }
  });

  printBtn.addEventListener('click', ()=> window.print());

  // initial render
  reset();
  // run initial calculation
  calculate();
})();
</script>
</body>
</html>
